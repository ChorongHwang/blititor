{% extends 'starter/layout.html' %}

{% block content %}
<div class="row">
    <div class="span12">
        <form id="postForm" action="/upload" method="POST" enctype="multipart/form-data">
            <fieldset>
                <legend>Make Post</legend>
                <label for="title">Title</label>
                <input class="input-block-level" type="text" id="title" name="title" placeholder="Title" data-bind="value: titleText, valueUpdate: 'afterkeydown'">
                <p class="controls">
                    <label class="checkbox inline"><input type="checkbox" name="home" value="1"> Use Home</label>
                    <label class="checkbox inline"><input type="checkbox" data-bind="checked: useMenu"> Use Top Menu</label>
                    <label class="checkbox inline"><input type="checkbox" data-bind="checked: useImage"> Use Background Image</label>
                </p>
                <div class="input-prepend" data-bind="visible: useMenu">
                    <span class="add-on">Menu</span>
                    <input class="span3" id="prependedInput" type="text" name="menu_title" placeholder="Menu Title">
                </div>
                <div class="input-prepend" data-bind="visible: useMenu">
                    <span class="add-on">Key</span>
                    <input class="span1" type="text" name="bind_key" placeholder="Bind">
                </div>
                <div class="input-prepend" data-bind="visible: useImage">
                    <input type="file" name="bg_image">
                </div>
                <p class="container">
                    <textarea class="input-block-level" id="summernote" name="content" rows="18"></textarea>
                </p>
                <label for="excerpt">Excerpt</label>
                <input class="input-block-level" type="text" id="excerpt" name="excerpt" placeholder="Excerpt">
            </fieldset>
            <button type="submit" class="btn btn-primary" data-bind="css: { disabled: !titleText() }">Save changes</button>
            <button type="button" id="cancel" class="btn">Cancel</button>
        </form>
    </div>
</div>
{% endblock %}

{% block script %}
<link href="/lib/font-awesome/build/assets/font-awesome/css/font-awesome.min.css" rel="stylesheet">
<link href="/js/summernote.css" rel="stylesheet">
<script src="/js/jquery.curstyles.min.js"></script>
<script src="/js/summernote.min.js"></script>
<script type="text/javascript">
    var postForm = function () {
        return postModel.titleText() ? true : false;
    };
    var postModel = {
        useMenu: ko.observable(false),
        useImage: ko.observable(false),
        titleText: ko.observable()
    };
    $(document).ready(function () {
        $('#summernote').summernote({
            height: 361,
            focus: true
        });
        ko.applyBindings(postModel);

        $('#cancel').click(function () {
            history.back();
        });
        var menu = 'post';
        $('#top_menu li[data-id="' + menu + '"]').addClass('active');

        // bind 'myForm' and provide a simple callback function
        $('#postForm').submit(function() {
            $('textarea[name="content"]').val($('#summernote').code()[0]);
            $(this).ajaxSubmit({
                beforeSubmit: postForm,
                success: function (response, status) {
                    if (status && response.id) {
                        location.href = '/list/' + response.id;
                    }
                }
            });
            return false;
        });
    });
</script>
{% endblock %}
